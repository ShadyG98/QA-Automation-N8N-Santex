{
  "name": "N8N Cloud - Chatbot con Audio Support",
  "nodes": [
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [
        -1664,
        112
      ],
      "id": "8c8213c0-2d94-4fef-9529-91e3f97f8e08",
      "name": "Telegram Trigger",
      "webhookId": "4251be9a-ceba-4b99-ad28-01af194a546d",
      "credentials": {
        "telegramApi": {
          "id": "Ko0Qi6EmfsuonsFz",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.message.text }}",
                    "rightValue": "",
                    "operator": {
                      "type": "object",
                      "operation": "notEmpty",
                      "singleValue": true
                    },
                    "id": "4c8d57ec-b435-447e-b6fc-b0c6cd7f2a17"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "text"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.message.voice }}",
                    "rightValue": "",
                    "operator": {
                      "type": "object",
                      "operation": "notEmpty",
                      "singleValue": true
                    },
                    "id": "692710b4-e8c3-4f70-8250-173852c90f95"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "voice"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.1,
      "position": [
        -1472,
        64
      ],
      "id": "6b08c003-bee8-4e79-8bf6-05d960a605da",
      "name": "Detect Message Type"
    },
    {
      "parameters": {
        "url": "=https://api.telegram.org/bot(botapikey)PM/getFile",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "telegramApi",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "file_id",
              "value": "={{ $json.message.voice ? $json.message.voice.file_id : $json.message.audio.file_id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1232,
        224
      ],
      "id": "7fbb2594-68f2-41f6-8632-315ec1cc5681",
      "name": "Get File Info",
      "credentials": {
        "telegramApi": {
          "id": "Ko0Qi6EmfsuonsFz",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "url": "=https://api.telegram.org/file/bot(botapikey)PM/{{ $json.result.file_path }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "telegramApi",
        "options": {
          "response": {
            "response": {
              "responseFormat": "file"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1040,
        224
      ],
      "id": "23e5e03e-ba09-43b0-8800-7051f1b939eb",
      "name": "Download Audio",
      "credentials": {
        "telegramApi": {
          "id": "Ko0Qi6EmfsuonsFz",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "message-text",
              "name": "message.text",
              "value": "={{ $json.text }}",
              "type": "string"
            },
            {
              "id": "message-from",
              "name": "message.from",
              "value": "={{ $('Telegram Trigger').item.json.message.from }}",
              "type": "object"
            },
            {
              "id": "message-chat",
              "name": "message.chat",
              "value": "={{ $('Telegram Trigger').item.json.message.chat }}",
              "type": "object"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -656,
        224
      ],
      "id": "0bd71caa-a3db-4501-8bb7-7754d77f3250",
      "name": "Format as Text Message"
    },
    {
      "parameters": {
        "options": {}
      },
      "name": "Google Gemini Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -416,
        320
      ],
      "id": "25cd0c64-1a4f-4a26-96f6-3f54eb1e97d5",
      "credentials": {
        "googlePalmApi": {
          "id": "32BDSoanJUPklZPZ",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "contextWindowLength": 10
      },
      "name": "Simple Memory",
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1,
      "position": [
        -224,
        320
      ],
      "id": "90d14361-de86-43aa-9601-27dfe21fe654"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.message.text }}\n\nüéì VERSI√ìN: 2.1 - CURSO N8N (CON SOPORTE DE VOZ üéôÔ∏è)\nEres el asistente de **Vinoteca Fran**. Respondes en espa√±ol, cordial y breve.\n\nüõ†Ô∏è **HERRAMIENTAS DISPONIBLES:**\n\nTienes la herramienta `google_sheets_manager` con estas operaciones:\n\n**1. get_catalog**\n- operation: \"get_catalog\"\n- params: {}\n- Retorna: {catalog: [...], categories: [...]}\n\n**2. get_products_by_category**\n- operation: \"get_products_by_category\"\n- params: {category: \"Cervezas\"}\n- Retorna: {products: [...]}\n\n**3. validate_order_stock** ‚≠ê NUEVA\n- operation: \"validate_order_stock\"\n- params: {order_items: [{producto: \"IPA\", cantidad: 2}]}\n- Retorna: {success: bool, hasStockIssues: bool, stockIssues: [...], validItems: [...]}\n\n**4. process_order**\n- operation: \"process_order\"\n- params: {order_items: [{producto: \"IPA\", cantidad: 2}]}\n- Retorna: {results: [...], lowStockAlerts: [...]}\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüîπ **SISTEMA DE COMANDOS:**\n\nDetecta si el mensaje del usuario es uno de estos comandos:\n\nüìå \"ayuda\" | \"help\" | \"?\"\n‚Üí Responde:\n\"üëã **GU√çA R√ÅPIDA DE USO**\n\n**üõí Para comprar:**\n‚Ä¢ Escribe 'categor√≠as' para ver todos los productos\n‚Ä¢ O escribe directamente: 'quiero vino tinto'\n‚Ä¢ üéôÔ∏è Tambi√©n puedes enviar mensajes de voz\n\n**üì¶ Para gestionar tu carrito:**\n‚Ä¢ 'carrito' - Ver lo que agregaste\n‚Ä¢ 'vaciar' - Limpiar el carrito\n‚Ä¢ 'finalizar' - Completar tu compra\n\n**‚ÑπÔ∏è Otros comandos:**\n‚Ä¢ 'ayuda' - Ver esta gu√≠a\n‚Ä¢ 'cancelar' - Volver al inicio\n\n¬øEn qu√© puedo ayudarte?\"\n\nüìå \"categorias\" | \"menu\" | \"categor√≠as\"\n‚Üí Llama a get_catalog y muestra:\n\"üìã **NUESTRAS CATEGOR√çAS:**\n\n1. üç∑ Vinos Tintos\n2. ü•Ç Vinos Blancos\n3. üçæ Espumantes\n4. ü•É Destilados\n5. üç∫ Cervezas\n6. ü•ì Fiambres\n7. üßÄ Quesos\n8. ü•ú Snacks & Complementos\n\nEscribe el nombre de una categor√≠a para ver los productos.\"\n\nüìå \"carrito\" | \"ver carrito\" | \"mi carrito\"\n‚Üí Si context.cart est√° vac√≠o:\n\"üõí **Tu carrito est√° vac√≠o**\n\nAgrega productos escribiendo:\n‚Ä¢ El nombre del producto: 'quiero Malbec'\n‚Ä¢ O explora las categor√≠as: 'categor√≠as'\"\n\n‚Üí Si tiene items:\n\"üõí **TU CARRITO:**\n\n{lista numerada de productos x cantidad}\n\n**Opciones:**\n‚Ä¢ Agregar m√°s: 'quiero [producto]'\n‚Ä¢ Finalizar compra: 'finalizar'\n‚Ä¢ Vaciar carrito: 'vaciar'\"\n\nüìå \"vaciar\" | \"limpiar\" | \"borrar carrito\"\n‚Üí context.cart = []\n‚Üí Responde:\n\"üóëÔ∏è Carrito vaciado correctamente.\n\n¬øQuieres empezar de nuevo? Escribe 'categor√≠as' para ver los productos.\"\n\nüìå \"cancelar\" | \"reiniciar\" | \"volver\"\n‚Üí Responde:\n\"üîÑ Proceso cancelado.\n\nTu carrito sigue intacto. ¬øQu√© quieres hacer?\n‚Ä¢ Ver carrito: 'carrito'\n‚Ä¢ Ver categor√≠as: 'categor√≠as'\n‚Ä¢ Ayuda: 'ayuda'\"\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüîπ **FLUJO DE COMPRA CON VALIDACI√ìN:**\n\n**PRIMER MENSAJE:**\n1. Llama get_catalog\n2. Muestra categor√≠as numeradas con emojis\n3. Saludo cordial\n\n**NAVEGACI√ìN:**\n- Usuario elige categor√≠a ‚Üí llama get_products_by_category\n- Muestra productos con precio\n\n**AGREGAR AL CARRITO:**\n- Usuario pide productos\n- Guarda en context.cart: [{producto, cantidad}]\n- Muestra confirmaci√≥n\n\n**FINALIZAR COMPRA (‚≠ê CON VALIDACI√ìN):**\n\nCuando el usuario dice \"finalizar\", \"comprar\", \"confirmar\":\n\n1Ô∏è‚É£ **Verificar carrito vac√≠o:**\nif (context.cart.length === 0) {\n  Responde:\n  \"üõí **Tu carrito est√° vac√≠o.**\n  \n  Para hacer un pedido:\n  1. Explora categor√≠as: 'categor√≠as'\n  2. O busca directamente: 'quiero Malbec'\n  3. Finaliza cuando tengas productos: 'finalizar'\n  \n  ¬øPor d√≥nde empezamos?\"\n  DETENER AQU√ç\n}\n\n2Ô∏è‚É£ **Validar stock PRIMERO:**\nLlama a validate_order_stock con context.cart\n\n3Ô∏è‚É£ **Analizar respuesta:**\n\nüî¥ Si hasStockIssues === true:\n  Para cada problema en stockIssues:\n  \n  ‚Ä¢ tipo: \"no_encontrado\"\n    ‚Üí \"‚ùå No encontr√© **'{producto}'** en nuestro cat√°logo.\n       \n       **Posibles soluciones:**\n       ‚Ä¢ Verifica la ortograf√≠a\n       ‚Ä¢ Consulta las categor√≠as: 'categor√≠as'\n       \n       ¬øQuieres modificar tu carrito?\"\n  \n  ‚Ä¢ tipo: \"agotado\"\n    ‚Üí \"‚ùå **'{producto}'** est√° **agotado** temporalmente.\n       \n       **Alternativas:**\n       ‚Ä¢ Ver productos similares en '{categor√≠a}'\n       ‚Ä¢ Eliminar del carrito: 'eliminar {producto}'\n       ‚Ä¢ Ver carrito: 'carrito'\"\n  \n  ‚Ä¢ tipo: \"stock_insuficiente\"\n    ‚Üí \"‚ö†Ô∏è **'{producto}'** solo tiene **{stockDisponible} unidades** disponibles (quer√≠as {cantidadSolicitada}).\n       \n       **Opciones:**\n       ‚úÖ ¬øQuieres llevar las {stockDisponible} disponibles?\n       üîÑ Elegir otro producto\n       üõí Ver tu carrito: 'carrito'\n       \n       ¬øQu√© prefieres?\"\n  \n  NO pidas direcci√≥n hasta resolver los problemas.\n  Espera respuesta del cliente.\n\n‚úÖ Si hasStockIssues === false (todo OK):\n  Muestra resumen:\n  \"üì¶ **RESUMEN DE TU PEDIDO:**\n  \n  {validItems[0].producto} x{cantidad}\n  {validItems[1].producto} x{cantidad}\n  ...\n  \n  ‚úÖ Todos los productos tienen stock disponible.\n  \n  Para confirmar, env√≠ame tu **direcci√≥n de entrega completa**\n  (calle, n√∫mero, ciudad).\n  \n  Si quieres modificar algo, escribe 'carrito' o 'vaciar'.\"\n  \n  context.awaitingAddress = true\n  Espera la direcci√≥n.\n\n4Ô∏è‚É£ **Cuando recibas la direcci√≥n:**\n- context.address = [direcci√≥n]\n- Llama a process_order con context.cart\n- context.cart = [] (vaciar)\n- context.awaitingAddress = false\n- Genera admin_notice con el pedido\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüîπ **GU√çA DE MENSAJES DE ERROR:**\n\nNUNCA respondas solo \"error\" o \"no encontrado\". Usa estos templates:\n\nüî¥ Producto no encontrado:\n\"‚ùå No encontr√© **'{producto}'** en nuestro cat√°logo.\n\n**Posibles soluciones:**\n‚Ä¢ Verifica la ortograf√≠a\n‚Ä¢ Consulta las categor√≠as: 'categor√≠as'\n‚Ä¢ Busca por tipo: 'vinos tintos', 'cervezas'\n\n¬øNecesitas ayuda? Escribe 'ayuda'\"\n\nüü° Stock insuficiente:\n\"‚ö†Ô∏è **'{producto}'** solo tiene **{stock} unidades** disponibles.\n\n**Opciones:**\n‚úÖ Llevar las {stock} disponibles\nüîÑ Elegir otro producto similar\nüõí Modificar tu carrito\n\n¬øQu√© prefieres?\"\n\nüî¥ Producto agotado:\n\"‚ùå **'{producto}'** est√° **agotado** temporalmente.\n\n**Alternativas:**\n‚Ä¢ Ver productos similares en '{categor√≠a}'\n‚Ä¢ Agregar otro producto: escribe el nombre\n‚Ä¢ Ver todas las categor√≠as: 'categor√≠as'\n\n¬øTe ayudo con algo m√°s?\"\n\nüî¥ Categor√≠a sin productos:\n\"‚ö†Ô∏è No encontr√© productos en **'{categor√≠a}'**.\n\nCategor√≠as disponibles:\n{lista de categor√≠as reales}\n\nSelecciona una para ver los productos.\"\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n‚öôÔ∏è **CONTEXTO (memoria interna):**\n- categories: lista de categor√≠as\n- cart: [{producto, cantidad}]\n- awaitingAddress: esperando direcci√≥n (true/false)\n- address: direcci√≥n de entrega\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n‚öôÔ∏è **SALIDA JSON:**\n\nResponde SIEMPRE con JSON (sin markdown):\n\n```json\n{\n  \"output\": \"mensaje para cliente\",\n  \"admin_notice\": \"\" o \"mensaje para admin\"\n}\n```\n\n**Usa admin_notice para:**\n- Nuevo pedido completado\n- Alertas importantes\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n‚ö†Ô∏è **REGLAS IMPORTANTES:**\n1. Los comandos tienen prioridad sobre b√∫squedas\n2. SIEMPRE valida stock con validate_order_stock ANTES de pedir direcci√≥n\n3. Usa emojis para hacer mensajes visuales\n4. Mant√©n tono amigable y profesional\n5. NO uses markdown en el JSON (ni ```json ni ```)\n6. NUNCA inventes productos ni precios\n7. üéôÔ∏è Procesa mensajes de voz igual que texto (ya vienen transcritos)",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -336,
        48
      ],
      "id": "efcc9bfa-a134-4c39-bcd5-a81e17f3eea2",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.from.id }}",
        "text": "={{ $json.output }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        160,
        48
      ],
      "id": "a5e892e8-a18c-4202-aca8-0ff24803f24e",
      "name": "Send to Client",
      "webhookId": "926f5328-7b03-4159-8204-99a549e82ea2",
      "credentials": {
        "telegramApi": {
          "id": "Ko0Qi6EmfsuonsFz",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "check-admin-notice",
              "leftValue": "={{ $json.hasAdminNotice }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "true"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        144,
        -144
      ],
      "id": "f686e309-55d9-43c3-81ae-97f5bb923c8e",
      "name": "Check Admin Notice"
    },
    {
      "parameters": {
        "chatId": "=-4820020222",
        "text": "={{ $json.admin_notice }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        352,
        -160
      ],
      "id": "8f11b3b9-3a50-4820-b281-fe5f306946eb",
      "name": "Send to Admin",
      "webhookId": "3d1568a7-330b-444a-8992-276cfee84b8c",
      "credentials": {
        "telegramApi": {
          "id": "Ko0Qi6EmfsuonsFz",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "description": "Gestiona el cat√°logo de Vinoteca Fran. Ll√°malo con operation (string) y params (objeto). Operaciones: get_catalog, get_products_by_category, validate_order_stock, process_order.",
        "workflowId": {
          "__rl": true,
          "value": "nlvodVBcB6S53Cej",
          "mode": "list",
          "cachedResultUrl": "/workflow/nlvodVBcB6S53Cej",
          "cachedResultName": "googleshethelper"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {}
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        -64,
        304
      ],
      "id": "bbb9c6b4-0c8b-4fe7-82cc-2cf839cd7c48",
      "name": "Google Sheets Tool"
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "analyze",
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-flash",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-flash"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -848,
        224
      ],
      "id": "759dfa2f-c363-4454-b223-63f329d28086",
      "name": "Analyze audio",
      "credentials": {
        "googlePalmApi": {
          "id": "32BDSoanJUPklZPZ",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const rawOutput = $json.output || \"\";\nconst cleaned = rawOutput.replace(/```json|```/g, \"\").trim();\n\nlet parsed;\ntry {\n  parsed = JSON.parse(cleaned);\n} catch (err) {\n  console.error(\"‚ùå Error parseando JSON:\", err.message);\n  console.error(\"Output:\", cleaned.substring(0, 200));\n  parsed = {\n    output: rawOutput || \"Disculp√°, hubo un error. Escrib√≠ 'categor√≠as'.\",\n    admin_notice: \"\"\n  };\n}\n\nconst output = (parsed.output?.trim?.() || \"\");\nconst admin_notice = (parsed.admin_notice?.trim?.() || \"\");\nconst hasAdminNotice = !!(admin_notice && admin_notice.length > 0);\n\nif (!output) {\n  console.error(\"‚ö†Ô∏è Output vac√≠o\");\n  return [{\n    output: \"Disculp√°, no entend√≠. ¬øQuer√©s ver las categor√≠as?\",\n    hasAdminNotice: false\n  }];\n}\n\nif (hasAdminNotice) {\n  console.log(\"üì¢ Notificaci√≥n admin:\", admin_notice.substring(0, 100));\n}\n\nconst result = { output, hasAdminNotice };\nif (hasAdminNotice) result.admin_notice = admin_notice;\n\nreturn [result];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -64,
        48
      ],
      "id": "c002c999-bc47-4dc7-a5b9-c07b988eb2b4",
      "name": "orquestador de mensajes para envio al admin y al usuario"
    }
  ],
  "pinData": {},
  "connections": {
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "Detect Message Type",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Detect Message Type": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get File Info",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get File Info": {
      "main": [
        [
          {
            "node": "Download Audio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download Audio": {
      "main": [
        [
          {
            "node": "Analyze audio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format as Text Message": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "orquestador de mensajes para envio al admin y al usuario",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Admin Notice": {
      "main": [
        [
          {
            "node": "Send to Admin",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Sheets Tool": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Analyze audio": {
      "main": [
        [
          {
            "node": "Format as Text Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "orquestador de mensajes para envio al admin y al usuario": {
      "main": [
        [
          {
            "node": "Send to Client",
            "type": "main",
            "index": 0
          },
          {
            "node": "Check Admin Notice",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "74ddfab8-db2a-467e-ba59-7d4fdc35e566",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "79d52978c751d51944ce8ad19ed27f343dc1ad96dad0e103a29e04dc4017ab1c"
  },
  "id": "RAJTezNurSOYA5mb",
  "tags": []
}
